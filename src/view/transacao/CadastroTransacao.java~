/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package view.transacao;

import controller.CategoriaTransacaoController;
import controller.TransacaoController;
import java.awt.Image;
import java.awt.Toolkit;
import java.beans.PropertyVetoException;
import java.sql.SQLException;
import java.text.NumberFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.Enumeration;
import java.util.Iterator;
import java.util.List;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.ButtonGroup;
import javax.swing.ImageIcon;
import javax.swing.JFormattedTextField;
import javax.swing.JOptionPane;
import javax.swing.JRadioButton;
import javax.swing.text.DefaultFormatterFactory;
import javax.swing.text.MaskFormatter;
import model.CategoriaTransacao;
import model.Transacao;
import view.DecimalFormattedField;
import view.KeyAdapterNumbersOnly;
import view.categoriaTransacao.CriarCategoria;
import view.usuario.MeuEscritorio;

/**
 *
 * @author Rodrigo
 */
public class CadastroTransacao extends javax.swing.JInternalFrame {

    /**
     * Creates new form CadastroTransacao
     */
    Transacao transacao;

    public CadastroTransacao() {
        initComponents();
        grupoRadioButton();
        preencheComboBox();
        Calendar c = Calendar.getInstance();
        SimpleDateFormat s = new SimpleDateFormat("dd/MM/yyyy");
        jTextFieldData.setText(s.format(c.getTime()));
        Transacao transacao = new Transacao();

    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {
        bindingGroup = new org.jdesktop.beansbinding.BindingGroup();

        label3 = new java.awt.Label();
        buttonGroup1 = new javax.swing.ButtonGroup();
        buttonGroup2 = new javax.swing.ButtonGroup();
        jComboBox1 = new javax.swing.JComboBox();
        jScrollPane1 = new javax.swing.JScrollPane();
        jTextAreaDescricao = new javax.swing.JTextArea();
        jLabel2 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        jButton1 = new javax.swing.JButton();
        jRadioButtonDespesa = new javax.swing.JRadioButton();
        jRadioButtonProvento = new javax.swing.JRadioButton();
        jRadioButtonDiario = new javax.swing.JRadioButton();
        jRadioButtonMensal = new javax.swing.JRadioButton();
        jRadioButtonAnual = new javax.swing.JRadioButton();
        barraValor = new DecimalFormattedField();
        jLabel1 = new javax.swing.JLabel();
        try{
            MaskFormatter mask = new MaskFormatter("##/##/####");
            jTextFieldData = new javax.swing.JFormattedTextField(mask);

            label3.setText("label3");

            setClosable(true);
            setTitle("Cadastrar Transação");

            jComboBox1.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Selecione a Categoria" }));
            jComboBox1.addActionListener(new java.awt.event.ActionListener() {
                public void actionPerformed(java.awt.event.ActionEvent evt) {
                    jComboBox1ActionPerformed(evt);
                }
            });

            jTextAreaDescricao.setColumns(20);
            jTextAreaDescricao.setRows(5);
            jScrollPane1.setViewportView(jTextAreaDescricao);

            org.jdesktop.beansbinding.Binding binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, jLabel2, org.jdesktop.beansbinding.ELProperty.create("Recorrência"), jLabel2, org.jdesktop.beansbinding.BeanProperty.create("text"));
            bindingGroup.addBinding(binding);

            jLabel3.setText("Valor (R$):");

            jButton1.setText("Cadastrar");
            jButton1.addActionListener(new java.awt.event.ActionListener() {
                public void actionPerformed(java.awt.event.ActionEvent evt) {
                    jButton1ActionPerformed(evt);
                }
            });

            jRadioButtonDespesa.setText("Despesa");

            jRadioButtonProvento.setText("Provento");

            jRadioButtonDiario.setText("Nenhuma");

            jRadioButtonMensal.setText("Mensal");

            jRadioButtonAnual.setText("Anual");

            //barraValor.addKeyListener(new KeyAdapterNumbersOnly());
            barraValor.setText("0,00");
            barraValor.addActionListener(new java.awt.event.ActionListener() {
                public void actionPerformed(java.awt.event.ActionEvent evt) {
                    barraValorActionPerformed(evt);
                }
            });

            jLabel1.setText("Data");

        }catch(Exception ex){

        }
        jTextFieldData.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextFieldDataActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(18, 18, 18)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(jRadioButtonDespesa)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(jRadioButtonProvento)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .addComponent(jComboBox1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addComponent(jScrollPane1)))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(14, 14, 14)
                        .addComponent(jLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 101, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jRadioButtonDiario)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jRadioButtonMensal)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jRadioButtonAnual)
                        .addGap(0, 212, Short.MAX_VALUE))
                    .addGroup(layout.createSequentialGroup()
                        .addContainerGap()
                        .addComponent(jLabel3, javax.swing.GroupLayout.PREFERRED_SIZE, 78, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(4, 4, 4)
                        .addComponent(barraValor, javax.swing.GroupLayout.PREFERRED_SIZE, 80, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(jButton1, javax.swing.GroupLayout.PREFERRED_SIZE, 116, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addGap(0, 0, Short.MAX_VALUE)
                        .addComponent(jLabel1)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jTextFieldData, javax.swing.GroupLayout.PREFERRED_SIZE, 147, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(10, 10, 10)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel1)
                    .addComponent(jTextFieldData, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(jRadioButtonDespesa)
                        .addComponent(jRadioButtonProvento))
                    .addComponent(jComboBox1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 197, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 8, Short.MAX_VALUE)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 28, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jRadioButtonDiario)
                    .addComponent(jRadioButtonMensal)
                    .addComponent(jRadioButtonAnual))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jButton1)
                    .addComponent(jLabel3, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(barraValor, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(14, Short.MAX_VALUE))
        );

        bindingGroup.bind();

        setBounds(0, 0, 600, 400);
    }// </editor-fold>//GEN-END:initComponents

    private void jComboBox1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jComboBox1ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jComboBox1ActionPerformed

    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed

        Transacao transacao = new Transacao();

        JRadioButton selecionado = new JRadioButton();
        selecionado = getSelectedRadio(buttonGroup1);
        if (selecionado != null) {
            transacao.tipoTransacao = selecionado.getText();
        }

        selecionado = getSelectedRadio(buttonGroup2);
        if (selecionado != null) {
            transacao.tipoRecorrencia = selecionado.getText();
        }

        transacao.emailUsuario = MeuEscritorio.usuarioLogado.email;
        transacao.dataInsercao = jTextFieldData.getText();

        String itemSelecionado = (String) jComboBox1.getSelectedItem();
        if (itemSelecionado.equals("Selecione a Categoria")) {
            transacao.categoria = "";
        } else {
            transacao.categoria = itemSelecionado;
        }

        if (!jTextAreaDescricao.getText().equals("")) {
            transacao.descricao = jTextAreaDescricao.getText();
        }

        transacao.valor = barraValor.getDoubleValue();

        try {

            TransacaoController transacaoController = new TransacaoController();
            transacaoController.adicionar(transacao);
            JOptionPane.showMessageDialog(null, "Transação cadastrado com sucesso");
            this.dispose();

        } catch (Exception ex) {
            JOptionPane.showMessageDialog(null, ex.getMessage());
        }

    }//GEN-LAST:event_jButton1ActionPerformed

    private void barraValorActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_barraValorActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_barraValorActionPerformed

    private void jTextFieldDataActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextFieldDataActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jTextFieldDataActionPerformed

    private void preencheComboBox() {
        try {
            CategoriaTransacaoController categoriaController = new CategoriaTransacaoController();
            List categorias = categoriaController.toList(MeuEscritorio.usuarioLogado.email);
            Iterator it = categorias.iterator();

            CategoriaTransacao categoria;
            while (it.hasNext()) {
                categoria = (CategoriaTransacao) it.next();
                jComboBox1.addItem(categoria.nome);
            }

        } catch (Exception ex) {
            JOptionPane.showMessageDialog(null, ex.getMessage());
        }

    }

    public void grupoRadioButton() {
        buttonGroup1.add(jRadioButtonDespesa);
        buttonGroup1.add(jRadioButtonProvento);
        buttonGroup2.add(jRadioButtonDiario);
        buttonGroup2.add(jRadioButtonMensal);
        buttonGroup2.add(jRadioButtonAnual);
    }

    public JRadioButton getSelectedRadio(ButtonGroup group) {
        for (Enumeration eRadio = group.getElements(); eRadio.hasMoreElements();) {
            JRadioButton radioButton = (JRadioButton) eRadio.nextElement();

            if (radioButton.getModel() == group.getSelection()) {
                return radioButton;
            }
        }

        return null;
    }


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private DecimalFormattedField barraValor;
    private javax.swing.ButtonGroup buttonGroup1;
    private javax.swing.ButtonGroup buttonGroup2;
    private javax.swing.JButton jButton1;
    private javax.swing.JComboBox jComboBox1;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JRadioButton jRadioButtonAnual;
    private javax.swing.JRadioButton jRadioButtonDespesa;
    private javax.swing.JRadioButton jRadioButtonDiario;
    private javax.swing.JRadioButton jRadioButtonMensal;
    private javax.swing.JRadioButton jRadioButtonProvento;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTextArea jTextAreaDescricao;
    private javax.swing.JFormattedTextField jTextFieldData;
    private java.awt.Label label3;
    private org.jdesktop.beansbinding.BindingGroup bindingGroup;
    // End of variables declaration//GEN-END:variables
}
